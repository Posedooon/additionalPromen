# ここで困った!orなるほど！となったことをメモしていく

# 仕組み部分

- @WicketHomePage は、Wicket-Spring-Bootが表示する最初のページに設定する  
- @MountPath("Home") は、HomePageクラスとそのHTMLを http://.../Home というURLでアクセスできるよう、URLのファイルパス部を設定する  
- Wicketが提供する WebPage クラスを継承することで、同じ名前のHTMLファイルを書き換える能力をもつ  
- JavaプログラムのLabel部分はHTMLページで設定したwicketidと反映させたいものを対にして構成される  
- BookmarkablePageLinkコンポーネントを使うと、任意のタグを任意のページへのリンクに書き換えられる  
- ____ラベルやリンクを設定したら必ずaddする！！！！____

# 匿名クラス（無名クラス）という概念について
- __新しくクラスを作成せずに抽象クラスやインタフェースをそのままインスタンス化させるような動作を行うことができる__  
- __クラス名が無い。ほとんどの場合、あるメソッドの中で宣言され、その中でしか使われない (1回かぎり)__
~~~
new 親クラスまたはインターフェイス名() {
    // 匿名クラスの内容 (フィールドやメソッドの定義)
};
~~~

## ユーザー認証はどのように作るか

ユーザ認証を作る方法は様々だが、Webシステムで最も基本的な方法は、

1. 認証済でなければ利用できないページを用意する
1. ある人物しか使えない情報（例：パスワード）がWebシステムに送られる
1. 送られた情報とWebシステム側の情報を照合する
1. 照合結果がOKであれば、ブラウザごとに情報を一時保存できる領域（例：HTTPセッションなど）に認証結果や付属情報（たとえば、システムの利用権限）となる情報を格納する
1. 照合結果がNGであれば、認証を促す（認証ページに移動させるなど）

という手順で作成できる。ここではこれを順を追って説明する。

<!--認証後時間が長く経った場合、同じブラウザを違う人間が使うことも考えられる。従って一定時間が経過したら、もう一度(OK/NG)を確認するか、もう一度（あるブラウザからWebシステムに送られてきた情報、外に出てくることを促す。-->

----
※今回はWicketに備わっている標準の認証フレームワーク Wicket-Auth-Roles を使う  
MySession.javaクラスを作る。重要なのは3つのメソッド
- **sign メソッド**<br>別の場所で行われた認証（照合）が成功したら、照合できたユーザ名を一時記録する。セッションはブラウザごとに用意されるので、ブラウザごとの利用者のユーザ名となる。
- **getRoles メソッド**<br>認証したユーザの役割を返り値にする。<strong>Wicketはこの値を使って、ページを表示してよいかダメかを判定する</strong>。この例では全員が `USER`（一般ユーザ） という役割になると一律で設定しているが、ユーザごとに管理者や他の役割（学生、教育、ゲスト...）を区別するようにもできる。
- **get メソッド**<br>クラスメソッド（staticなメソッド）なので、インスタンス化（new）せずに利用できる。Wicketでセッション情報を変更したり取り出したりするときは、必ずこのメソッド経由で行う（後述）。


Applicationクラスの返り値を変えて、 getWebSession メソッドをオーバーライドする。  
先ほど作成した MySession クラスを返り値とすれば、このクラスの getRoles メソッドを使って、ページの表示の可・不可を判断させることができる

<確認部分>
- Wicketは、 _@AuthorizeInstantiation_ に設定されている _Roles.USER_ と、 _MySession_ クラスの _getRoles_ メソッドの戻り値で、ページ表示の可・不可を判断する。

- MySession クラスの _getRoles_ メソッドは、ユーザ認証済みの時に _new Roles(Roles.USER)_ を戻す。_new Roles()_ の中身が _@AuthorizeInstantiation_ の値と一致しているので、ページを表示する。

- 一方で、 _MySession_ クラスの _getRoles_ メソッドは、ユーザが未認証の時に _new Roles()_ を戻す。_new Roles()_ の中身が _@AuthorizeInstantiation_ の値と一致していないので、ページを表示しない
# 適宜更新！